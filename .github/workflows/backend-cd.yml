name: Backend CD

# Only trigger after Backend CI completes successfully
on:
  workflow_run:
    workflows: ["Backend CI"]
    types:
      - completed

jobs:
  deploy:
    # Only run if the CI workflow succeeded AND it is the main branch
    if: ${{ github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.head_branch == 'main' }}
    runs-on: ubuntu-latest

    steps:
    - name: Trigger Render Deployment
      env:
        RENDER_DEPLOY_HOOK: ${{ secrets.RENDER_DEPLOY_HOOK }}
      run: |
        if [ -z "$RENDER_DEPLOY_HOOK" ]; then
          echo "Error: RENDER_DEPLOY_HOOK secret is missing."
          exit 1
        fi
        
        # Trigger deployment via Render's Webhook
        curl -X POST "$RENDER_DEPLOY_HOOK"
        echo "Deployment triggered successfully."
